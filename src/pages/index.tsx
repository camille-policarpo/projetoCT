import { FormEvent, useState } from 'react'
import type { NextPage } from 'next'
import Head from 'next/head'
import { Flex, Box, Text, Input, Button, Image, Toast, useToast} from '@chakra-ui/react';
import { Coordenadas, Openmeteo } from '../services/axios';
import { FaTemperatureHigh } from 'react-icons/fa'
import { TbTemperatureMinus , TbTemperaturePlus } from 'react-icons/tb'
import { MdOutlineWaterDrop } from 'react-icons/md'
import { stringify } from 'querystring';

interface Coordenada {
  latitude: number;
  longitude: number;
}

const Home: NextPage = () => {

  const [coordenadas, setCoordenada] = useState<Coordenada | null>();
  const [texto, setTexto] = useState('');
  const [temp, setTemp] = useState('');
  const [tMin, setTMin] = useState('');
  const [tMax, setTMax] = useState('');
  const [umi, setUmi] = useState('');

  const [name, setName] = useState('');

  const toast = useToast();

  async function onSubmit(event: FormEvent){
    event.preventDefault();
      try {
        const res = await Coordenadas.get(`search?name=${texto}&language=pt&count=1`).then((data) => {
          const {latitude,longitude,timezone} = data.data.results[0]
          const name = data.data.results[0].name
          	
          toast({
            title: `Cidade encontrada: ${name}`,
            status: 'success',
            duration: 9000,
            isClosable: true,
          })
          
      
          let newTimezone = timezone.replace ('/', '%2F');
          console.log(name)
    
        
    
          const api = Openmeteo.get(`forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,relativehumidity_2m&daily=temperature_2m_max,temperature_2m_min&timezone=${newTimezone}`) .then((data) => {
             
            setTMax(data.data.daily.temperature_2m_max[0])
             setTMin (data.data.daily.temperature_2m_min[0])
             setUmi (data.data.hourly.relativehumidity_2m[0])
             setTemp (data.data.hourly.temperature_2m[0])
         }
        )
      })
      } catch (error) {
        toast({
          title: 'Cidade NÃO encontrada.',
          description: "Tente novamente.",
          status: 'error',
          duration: 9000,
          isClosable: true,
        })
      }

}
  
  return (
    <div>
      <Head>
        <title>Consulte o tempo</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
          <Flex as="form" alignItems={"center"} h='100vh' justifyContent='center' bg='gray.300' onSubmit={(event) => onSubmit(event)}>
            <Flex borderRadius="xl" boxShadow={'2xl'} bgImage={'ceu.jpg'} padding={"10"} direction={'column'} width='380px'> 
            <Text fontSize={'2xl'} >Digite a cidade:</Text>
            <Box bgColor={'whiteAlpha.400'} borderRadius="xl" border='0px' ><Input  onChange={(event) => setTexto(event.target.value)}/></Box>
            <Button bgColor={'white.400'} type="submit" size={'sm'} width='70px' alignSelf={'center'}>ENVIAR</Button>

            <Flex alignItems='start' direction={'column'}>
              <FaTemperatureHigh />   <Text fontSize={'xl'} noOfLines={1} color={''}> Temperatura: {temp} (°C)</Text>
              <MdOutlineWaterDrop />  <Text  fontSize={'xl'} noOfLines={1} color={''}> Umidade: {umi} (%)</Text>
              <TbTemperaturePlus />   <Text fontSize={'xl'} color={''}> Temp máxima do dia: {tMax} (°C)</Text>
              <TbTemperatureMinus />  <Text fontSize={'xl'} color={''}> Temp mínima do dia: {tMin} (°C)</Text>
            </Flex>

            </Flex>
          </Flex>

      </main>
    </div>
  )
}

export default Home